var t,r;!function(t){t.ERR_CONFIG_SDK_INIT_OPTION='[WoodpeckerProxy] Missing "sdkInit" option.',t.ERR_PATH_REWRITER_CONFIG="[WoodpeckerProxy] Invalid path config. Expecting object with path config or a rewrite function",t.ERR_HOST_CONFIG="[WoodpeckerProxy] Invalid host config. Expecting object or function or empty",t.ERR_PATCHING_SCRIPT="[WoodpeckerProxy] unable to prevent script execution for script src %s .\n",t.ERR_CONFIG_SDK_LOG_PROVIDER="[WoodpeckerProxy] Log provider config error. Expecting a function.",t.ERR_CONFIG_SDK_LOG_LEVEL="[WoodpeckerProxy] Log level error. Invalid logLevel."}(t||(t={})),function(t){t.MESSAGE_GOT_SCRIPT="[WoodpeckerProxy] got new script %s",t.MESSAGE_BLOCKED_SCRIPT="[WoodpeckerProxy] blocked and replace script %s to %s",t.MESSAGE_SCRIPT_LOADED="[WoodpeckerProxy] new script onload %s",t.MESSAGE_START_STATIC_SCRIPT="[WoodpeckerProxy] start load static new script %s",t.MESSAGE_START_DYNAMIC_SCRIPT="[WoodpeckerProxy] start load dynamic new script %s"}(r||(r={}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function e(t,r){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var n,o,c=e.call(t),i=[];try{for(;(void 0===r||r-- >0)&&!(n=c.next()).done;)i.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(e=c.return)&&e.call(c)}finally{if(o)throw o.error}}return i}function n(){for(var t=[],r=0;r<arguments.length;r++)t=t.concat(e(arguments[r]));return t}var o=function(t,r){for(var e=-1,n=null==t?0:t.length;++e<n&&!1!==r(t[e],e,t););return t};var c=function(t){return function(r,e,n){for(var o=-1,c=Object(r),i=n(r),a=i.length;a--;){var u=i[t?a:++o];if(!1===e(c[u],u,c))break}return r}}();var i=function(t,r){for(var e=-1,n=Array(t);++e<t;)n[e]=r(e);return n},a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function u(t,r,e){return t(e={path:r,exports:{},require:function(t,r){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==r&&e.path)}},e.exports),e.exports}var f="object"==typeof a&&a&&a.Object===Object&&a,l="object"==typeof self&&self&&self.Object===Object&&self,p=f||l||Function("return this")(),s=p.Symbol,v=Object.prototype,d=v.hasOwnProperty,y=v.toString,b=s?s.toStringTag:void 0;var h=function(t){var r=d.call(t,b),e=t[b];try{t[b]=void 0;var n=!0}catch(t){}var o=y.call(t);return n&&(r?t[b]=e:delete t[b]),o},j=Object.prototype.toString;var g=function(t){return j.call(t)},E=s?s.toStringTag:void 0;var _=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":E&&E in Object(t)?h(t):g(t)};var w=function(t){return null!=t&&"object"==typeof t};var O=function(t){return w(t)&&"[object Arguments]"==_(t)},S=Object.prototype,R=S.hasOwnProperty,A=S.propertyIsEnumerable,P=O(function(){return arguments}())?O:function(t){return w(t)&&R.call(t,"callee")&&!A.call(t,"callee")},T=Array.isArray;var m=function(){return!1},I=u((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e?p.Buffer:void 0,c=(o?o.isBuffer:void 0)||m;t.exports=c})),L=/^(?:0|[1-9]\d*)$/;var x=function(t,r){var e=typeof t;return!!(r=null==r?9007199254740991:r)&&("number"==e||"symbol"!=e&&L.test(t))&&t>-1&&t%1==0&&t<r};var C=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},G={};G["[object Float32Array]"]=G["[object Float64Array]"]=G["[object Int8Array]"]=G["[object Int16Array]"]=G["[object Int32Array]"]=G["[object Uint8Array]"]=G["[object Uint8ClampedArray]"]=G["[object Uint16Array]"]=G["[object Uint32Array]"]=!0,G["[object Arguments]"]=G["[object Array]"]=G["[object ArrayBuffer]"]=G["[object Boolean]"]=G["[object DataView]"]=G["[object Date]"]=G["[object Error]"]=G["[object Function]"]=G["[object Map]"]=G["[object Number]"]=G["[object Object]"]=G["[object RegExp]"]=G["[object Set]"]=G["[object String]"]=G["[object WeakMap]"]=!1;var k=function(t){return w(t)&&C(t.length)&&!!G[_(t)]};var M=function(t){return function(r){return t(r)}},D=u((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e&&f.process,c=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=c})),N=D&&D.isTypedArray,F=N?M(N):k,W=Object.prototype.hasOwnProperty;var V=function(t,r){var e=T(t),n=!e&&P(t),o=!e&&!n&&I(t),c=!e&&!n&&!o&&F(t),a=e||n||o||c,u=a?i(t.length,String):[],f=u.length;for(var l in t)!r&&!W.call(t,l)||a&&("length"==l||o&&("offset"==l||"parent"==l)||c&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||x(l,f))||u.push(l);return u},U=Object.prototype;var B=function(t){var r=t&&t.constructor;return t===("function"==typeof r&&r.prototype||U)};var H=function(t,r){return function(e){return t(r(e))}},K=H(Object.keys,Object),$=Object.prototype.hasOwnProperty;var q=function(t){if(!B(t))return K(t);var r=[];for(var e in Object(t))$.call(t,e)&&"constructor"!=e&&r.push(e);return r};var z=function(t){var r=typeof t;return null!=t&&("object"==r||"function"==r)};var Y=function(t){if(!z(t))return!1;var r=_(t);return"[object Function]"==r||"[object GeneratorFunction]"==r||"[object AsyncFunction]"==r||"[object Proxy]"==r};var J=function(t){return null!=t&&C(t.length)&&!Y(t)};var Q=function(t){return J(t)?V(t):q(t)};var X=function(t,r){return function(e,n){if(null==e)return e;if(!J(e))return t(e,n);for(var o=e.length,c=r?o:-1,i=Object(e);(r?c--:++c<o)&&!1!==n(i[c],c,i););return e}}((function(t,r){return t&&c(t,r,Q)}));var Z=function(t){return t};var tt=function(t){return"function"==typeof t?t:Z};var rt=function(t,r){return(T(t)?o:X)(t,tt(r))},et="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";function nt(){}function ot(t){return/^(?:[a-z]+:)?\/\//i.test(t)}function ct(t){return t.replace(/^(?:[a-z]+:)?\/\//,"").replace(/\/.*/,"")}function it(r){if(function(r){if(T(r))return!0;throw new Error(t.ERR_PATH_REWRITER_CONFIG)}(r))return function(t){var e=function(t){var r;if(window.URL)r=ot(t)?new URL(t).pathname:new URL(t,location.href).pathname;else{var e=document.createElement("a");e.href=t,r=e.pathname,e=null}return r}(t),n=e,o=!1;return rt(r,(function(t){if(t.regex.test(e))return o=!0,n=n.replace(t.regex,t.value),!1})),!!o&&n}}var at=H(Object.getPrototypeOf,Object),ut=Function.prototype,ft=Object.prototype,lt=ut.toString,pt=ft.hasOwnProperty,st=lt.call(Object);var vt,dt=function(t){if(!w(t)||"[object Object]"!=_(t))return!1;var r=at(t);if(null===r)return!0;var e=pt.call(r,"constructor")&&r.constructor;return"function"==typeof e&&e instanceof e&&lt.call(e)==st},yt=p["__core-js_shared__"],bt=(vt=/[^.]+$/.exec(yt&&yt.keys&&yt.keys.IE_PROTO||""))?"Symbol(src)_1."+vt:"";var ht=function(t){return!!bt&&bt in t},jt=Function.prototype.toString;var gt=function(t){if(null!=t){try{return jt.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Et=/^\[object .+?Constructor\]$/,_t=Function.prototype,wt=Object.prototype,Ot=_t.toString,St=wt.hasOwnProperty,Rt=RegExp("^"+Ot.call(St).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var At=function(t){return!(!z(t)||ht(t))&&(Y(t)?Rt:Et).test(gt(t))};var Pt=function(t,r){return null==t?void 0:t[r]};var Tt=function(t,r){var e=Pt(t,r);return At(e)?e:void 0},mt=Tt(p,"DataView"),It=Tt(p,"Map"),Lt=Tt(p,"Promise"),xt=Tt(p,"Set"),Ct=Tt(p,"WeakMap"),Gt=gt(mt),kt=gt(It),Mt=gt(Lt),Dt=gt(xt),Nt=gt(Ct),Ft=_;(mt&&"[object DataView]"!=Ft(new mt(new ArrayBuffer(1)))||It&&"[object Map]"!=Ft(new It)||Lt&&"[object Promise]"!=Ft(Lt.resolve())||xt&&"[object Set]"!=Ft(new xt)||Ct&&"[object WeakMap]"!=Ft(new Ct))&&(Ft=function(t){var r=_(t),e="[object Object]"==r?t.constructor:void 0,n=e?gt(e):"";if(n)switch(n){case Gt:return"[object DataView]";case kt:return"[object Map]";case Mt:return"[object Promise]";case Dt:return"[object Set]";case Nt:return"[object WeakMap]"}return r});var Wt=Ft,Vt=Object.prototype.hasOwnProperty;var Ut=function(t){if(null==t)return!0;if(J(t)&&(T(t)||"string"==typeof t||"function"==typeof t.splice||I(t)||F(t)||P(t)))return!t.length;var r=Wt(t);if("[object Map]"==r||"[object Set]"==r)return!t.size;if(B(t))return!q(t).length;for(var e in t)if(Vt.call(t,e))return!1;return!0};var Bt=function(t){var r=[];if(null!=t)for(var e in Object(t))r.push(e);return r},Ht=Object.prototype.hasOwnProperty;var Kt=function(t){if(!z(t))return Bt(t);var r=B(t),e=[];for(var n in t)("constructor"!=n||!r&&Ht.call(t,n))&&e.push(n);return e};var $t=function(t){return J(t)?V(t,!0):Kt(t)};var qt=function(t,r){return null==t?t:c(t,tt(r),$t)};function zt(r){if(function(r){if(dt(r)||Y(r)||Ut(r))return!0;throw new Error(t.ERR_HOST_CONFIG)}(r)){if(dt(r))return function(t){var e=Yt(t),n=e;return qt(r,(function(t,r){var o=ct(r);if(e===o)return n=ct(t),!1})),n};if(Y(r)){var e=r;return function(t){var r=e(t);return r=ct(r)}}return function(t){return Yt(t)}}}function Yt(t){var r;if(window.URL)r=ot(t)?new URL(t).host:location.host;else{var e=document.createElement("a");e.href=t,r=e.host,e=null}return r}var Jt,Qt,Xt,Zt={log:console.log,debug:console.log,info:console.info,warn:console.warn,error:console.error};function tr(){return Jt||(Jt=new rr),Jt}!function(t){t[t.debug=10]="debug",t[t.info=20]="info",t[t.warn=30]="warn",t[t.error=50]="error",t[t.silent=80]="silent"}(Qt||(Qt={})),function(t){t.debug="debug",t.info="info",t.warn="warn",t.error="error",t.silent="silent"}(Xt||(Xt={}));var rr=function(){function r(){this.setLevel(Xt.info),this.setProvider((function(){return Zt}))}return r.prototype.log=function(){var t;(t=this.provider).log.apply(t,n(arguments))},r.prototype.debug=function(){var t;this._showLevel(Xt.debug)&&(t=this.provider).debug.apply(t,n(arguments))},r.prototype.info=function(){var t;this._showLevel(Xt.info)&&(t=this.provider).info.apply(t,n(arguments))},r.prototype.warn=function(){var t;this._showLevel(Xt.warn)&&(t=this.provider).warn.apply(t,n(arguments))},r.prototype.error=function(){var t;this._showLevel(Xt.error)&&(t=this.provider).error.apply(t,n(arguments))},r.prototype.setLevel=function(t){this.isValidLevel(t)&&(this.logLevel=t)},r.prototype.setProvider=function(t){t&&this.isValidProvider(t)&&(this.provider=t(Zt))},r.prototype.isValidProvider=function(r){if(r&&!Y(r))throw new Error(t.ERR_CONFIG_SDK_LOG_PROVIDER);return!0},r.prototype.isValidLevel=function(r){var e=Object.keys(Qt).includes(r);if(!e)throw new Error(t.ERR_CONFIG_SDK_LOG_LEVEL);return e},r.prototype._showLevel=function(t){var r=!1,e=Qt[this.logLevel];return e&&e<=Qt[t]&&(r=!0),r},r}(),er=tr();function nr(t,r,e,n){void 0===n&&(n=nt),console.log("createNewScript",r);var o=Document.prototype.createElement.call(document,"script");Object.keys(HTMLScriptElement.prototype).forEach((function(r){if("src"!==r&&"type"!==r&&t[r]&&"object"!=typeof t[r])try{o[r]=t[r]}catch(t){}})),o.setAttribute("data-wp-proxy",e),o.src=r,o.type="text/javascript",o.onload=function(){Y(t.onload)&&t.onload(),n()},o.onerror=t.onerror;var c=t.getAttribute("nonce");return c&&o.setAttribute("nonce",c),document.getElementsByTagName("head")[0].appendChild(o),t.parentElement.removeChild(t),o}function or(t,e,n){void 0===n&&(n=nt);var o=t.defer||t.async,c=function(){for(var t=[],r=0,e=void 0;r<20;++r)e=Math.floor(Math.random()*et.length),t.push(et.charAt(e));return t.join("").toLowerCase()}();console.log(document.currentScript),o||"loading"!==document.readyState?(er.debug(r.MESSAGE_START_DYNAMIC_SCRIPT,e),nr(t,e,c,n)):(er.debug(r.MESSAGE_START_STATIC_SCRIPT,e),-1===navigator.userAgent.toLowerCase().indexOf("firefox")?function(t,r,e,n){void 0===n&&(n=nt),console.log("rewriteSrc",r),t.setAttribute("data-wp-proxy",e),t.src=r,t.type="text/javascript";var o=t.onload;t.onload=function(){Y(o)&&o(),n()}}(t,e,c,n):(t.async=!1,t.defer=!0,nr(t,e,c,n)))}var cr=tr();var ir=tr();var ar=function(e,o){var c,i;if(c=e.logLevel,i=e.logProvider,c&&ir.setLevel(c),i&&ir.setProvider(i),!e)throw new Error(t.ERR_CONFIG_SDK_INIT_OPTION);this._initiated=!0,function(e,o,c){var i=it(e),a=zt(o),u=c||location.protocol;function f(t,r){return!!r&&!t.getAttribute("data-wp-proxy")&&!!i(r)}new MutationObserver((function(t){t.forEach((function(t){t.addedNodes.forEach((function(t){if(1===t.nodeType&&"SCRIPT"===t.tagName){var e=t.src,n=f(t,e);if(cr.debug(r.MESSAGE_GOT_SCRIPT,n?'😇 matched "'+e+'"':'😈 not matched "'+e+'"'),f(t,e)){t.type="javascript/blocked";var o=function(r){"javascript/blocked"===t.getAttribute("type")&&r.preventDefault(),t.removeEventListener("beforescriptexecute",o)};t.addEventListener("beforescriptexecute",o);var c=u+"//"+a(e)+i(e);cr.debug(r.MESSAGE_BLOCKED_SCRIPT,e,c),or(t,c,(function(){cr.debug(r.MESSAGE_SCRIPT_LOADED,c)}))}}}))}))})).observe(document.documentElement,{childList:!0,subtree:!0});var l=document.createElement;document.createElement=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if("script"!==r[0].toLowerCase())return l.bind(document).apply(void 0,n(r));var o=l.bind(document).apply(void 0,n(r)),c=o.setAttribute.bind(o);try{Object.defineProperties(o,{src:{get:function(){return o.getAttribute("src")},set:function(t){return f(o,t)&&c("type","javascript/blocked"),c("src",t),!0}},type:{set:function(t){var r=t;return f(o,o.src)&&(r="javascript/blocked"),c("type",r),!0}}}),o.setAttribute=function(t,r){"type"===t||"src"===t?o[t]=r:HTMLScriptElement.prototype.setAttribute.call(o,t,r)}}catch(r){cr.error(t.ERR_PATCHING_SCRIPT,o.src,r)}return o}}(e.path,e.host,e.protocol),"function"==typeof o&&o()};ar.version="0.1.0",ar._initiated=!1,ar.init=ar;export default ar;
//# sourceMappingURL=wp-proxy.esm.js.map
